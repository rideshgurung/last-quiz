<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>House Scoreboard ‚Äî Royal Classic</title>
<style>
  :root{
    --bg:#071028;
    --panel:#0f1b33;
    --muted:#bfcbdc;
    --accent:#d4af37; /* gold */
    --glass: rgba(255,255,255,0.03);
    --card:#14253f;
    --success:#2fa360;
    --danger:#c94a3f;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100vh;
    background: linear-gradient(180deg,#051026 0%, #071028 60%);
    color:var(--muted);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:28px;
  }

  header{ text-align:center; margin-bottom:18px; user-select:none; }
  h1{ font-size:28px; margin:0 0 6px; letter-spacing:0.6px; color:#f6ecd6; }
  .roundLabel{ color:var(--muted); font-size:14px }

  main{ width:100%; max-width:1100px; }

  /* grid */
  .grid{
    width:100%;
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:18px;
  }

  .house{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:18px;
    border-left:8px solid transparent;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    min-height:170px;
    box-shadow: 0 8px 24px rgba(3,8,20,0.6);
    transition: transform .12s ease, box-shadow .12s ease;
  }
  .house:hover{ transform: translateY(-4px); box-shadow: 0 14px 40px rgba(3,8,20,0.7); }

  .house h2{ margin:0; font-size:18px; text-transform:uppercase; letter-spacing:0.6px; color:#fff; }
  .score{ font-size:40px; font-weight:700; margin:0; color:#fff; text-shadow: 0 2px 8px rgba(0,0,0,0.6); }
  .btn-row{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center }
  .btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--muted);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    min-width:68px;
    text-align:center;
    font-weight:700;
    letter-spacing:0.4px;
    transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .btn:active{ transform:scale(.98) }
  .btn.positive{
    background: linear-gradient(180deg, rgba(212,175,55,0.06), rgba(212,175,55,0.02));
    color:#fff;
    border-color: rgba(212,175,55,0.22);
    box-shadow: 0 6px 18px rgba(212,175,55,0.06);
  }
  .btn.negative{
    background: linear-gradient(180deg, rgba(201,74,63,0.03), rgba(201,74,63,0.0));
    color:#ffdcdc;
    border-color: rgba(255,255,255,0.03);
  }

  /* house color bars (subtle) */
  .red{ border-left-color: #e54b3c; }
  .blue{ border-left-color: #3b82f6; }
  .green{ border-left-color: #27b36a; }
  .yellow{ border-left-color: #f1c40f; color:#081018; }

  /* controls */
  .controls{
    margin-top:16px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:center;
  }
  .primary{
    background: linear-gradient(180deg, #2b5f9a, #183b61);
    color:#fff;
    border:none;
    padding:12px 18px;
    border-radius:10px;
    cursor:pointer;
    font-weight:800;
    letter-spacing:0.6px;
    box-shadow: 0 8px 24px rgba(2,8,20,0.6);
  }
  .muted{
    background:transparent;
    border:1px solid rgba(255,255,255,0.04);
    color:var(--muted);
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
  }

  /* leaderboard overlay */
  .overlay{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(4,6,12,0.6);
    z-index:40;
    opacity:0;
    pointer-events:none;
    transition:opacity .22s ease;
    padding:20px;
  }
  .overlay.show{ opacity:1; pointer-events:auto; }

  .panel{
    width:min(760px,98%);
    background: linear-gradient(180deg, rgba(24,36,60,0.95), rgba(14,24,40,0.95));
    border-radius:12px;
    padding:22px;
    text-align:left;
    box-shadow:0 30px 60px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    transform: translateY(8px);
    animation:pop .12s ease forwards;
    border: 1px solid rgba(212,175,55,0.06);
  }
  @keyframes pop{ from { transform:translateY(12px); opacity:0 } to { transform:none; opacity:1 } }

  .panel h3{ margin:0 0 10px; font-size:20px; color:#f6ecd6 }
  .ranks{ display:flex; flex-direction:column; gap:10px; margin:10px 0 14px }
  .rankRow{ display:flex; justify-content:space-between; align-items:center; padding:12px; border-radius:8px; background: rgba(255,255,255,0.02); }
  .rankRow .name{ text-transform:uppercase; font-weight:800; letter-spacing:0.6px; color:#fff }
  .rankRow .value{ font-weight:900; font-size:18px; color:var(--muted) }

  .panel .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:6px }

  /* ceremony */
  .ceremony{
    margin-top:18px;
    width:100%;
    max-width:760px;
    text-align:center;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
    border-radius:12px;
    padding:22px;
    display:none;
    border: 1px solid rgba(212,175,55,0.06);
  }
  .ceremony.show{ display:block }
  .winner{ font-size:22px; font-weight:800; margin:8px 0; color:#fff }
  .winner .house{ display:inline-block; padding:6px 12px; border-radius:8px; background: linear-gradient(180deg,#f7e9c6,#ecd78b); color:#0b0b0b; margin-left:8px; font-weight:900; }

  /* small screens */
  @media (max-width:820px){
    .grid{ grid-template-columns:1fr; }
    .controls{ flex-direction:column; gap:10px; }
  }
</style>
</head>
<body>
  <header>
    <h1>House Scoreboard ‚Äî Royal Classic</h1>
    <div class="roundLabel" id="roundLabel">Round 1 of 11</div>
  </header>

  <main>
    <section class="grid" id="housesGrid">
      <div class="house red" data-house="red">
        <h2>Red</h2>
        <p class="score" id="score-red">0</p>
        <div class="btn-row">
          <button class="btn positive" data-house="red" data-value="5">+5</button>
          <button class="btn positive" data-house="red" data-value="10">+10</button>
          <button class="btn positive" data-house="red" data-value="20">+20</button>
          <button class="btn negative" data-house="red" data-value="-5">‚àí5</button>
          <button class="btn negative" data-house="red" data-value="-10">‚àí10</button>
        </div>
      </div>

      <div class="house blue" data-house="blue">
        <h2>Blue</h2>
        <p class="score" id="score-blue">0</p>
        <div class="btn-row">
          <button class="btn positive" data-house="blue" data-value="5">+5</button>
          <button class="btn positive" data-house="blue" data-value="10">+10</button>
          <button class="btn positive" data-house="blue" data-value="20">+20</button>
          <button class="btn negative" data-house="blue" data-value="-5">‚àí5</button>
          <button class="btn negative" data-house="blue" data-value="-10">‚àí10</button>
        </div>
      </div>

      <div class="house green" data-house="green">
        <h2>Green</h2>
        <p class="score" id="score-green">0</p>
        <div class="btn-row">
          <button class="btn positive" data-house="green" data-value="5">+5</button>
          <button class="btn positive" data-house="green" data-value="10">+10</button>
          <button class="btn positive" data-house="green" data-value="20">+20</button>
          <button class="btn negative" data-house="green" data-value="-5">‚àí5</button>
          <button class="btn negative" data-house="green" data-value="-10">‚àí10</button>
        </div>
      </div>

      <div class="house yellow" data-house="yellow">
        <h2>Yellow</h2>
        <p class="score" id="score-yellow">0</p>
        <div class="btn-row">
          <button class="btn positive" data-house="yellow" data-value="5">+5</button>
          <button class="btn positive" data-house="yellow" data-value="10">+10</button>
          <button class="btn positive" data-house="yellow" data-value="20">+20</button>
          <button class="btn negative" data-house="yellow" data-value="-5">‚àí5</button>
          <button class="btn negative" data-house="yellow" data-value="-10">‚àí10</button>
        </div>
      </div>
    </section>

    <div class="controls" aria-hidden="false">
      <button id="finishRoundBtn" class="primary">Finish Round</button>
      <button id="saveBtn" class="muted">Save Now</button>
      <button id="resetBtn" class="muted">Reset All</button>
    </div>

    <section class="ceremony" id="ceremony" aria-hidden="true">
      <div class="badge" id="ceremonyBadge">Final Ceremony</div>
      <div class="winner" id="winnerText"></div>
    </section>
  </main>

  <!-- Leaderboard overlay -->
  <div class="overlay" id="leaderOverlay" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="leaderTitle">
      <h3 id="leaderTitle">Total Scores After Round <span id="overlayRoundNum">1</span></h3>
      <div class="ranks" id="ranksContainer"></div>
      <div class="panel-actions" style="display:flex; gap:10px; justify-content:flex-end; margin-top:6px;">
        <button id="continueBtn" class="btn positive">Next Round</button>
        <button id="finishAllBtn" class="btn negative">End Quiz</button>
      </div>
    </div>
  </div>

  <!-- audio (short ding) -->
  <audio id="ding" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5d494c262d.mp3?filename=correct-2-46134.mp3" type="audio/mpeg">
  </audio>

<script>
(() => {
  const TOTAL_ROUNDS = 11;
  let currentRound = 1;
  const houseKeys = ['red','blue','green','yellow'];
  const storageKey = 'house_total_scores_royal_v1';

  // load totals (persistent)
  let totalScores = { red:0, blue:0, green:0, yellow:0 };
  try {
    const raw = localStorage.getItem(storageKey);
    if (raw) {
      const parsed = JSON.parse(raw);
      houseKeys.forEach(k => { if (typeof parsed[k] === 'number') totalScores[k] = parsed[k]; });
    }
  } catch(e){ console.warn('Unable to parse saved totals', e); }

  // round-only scores (reset each round)
  let roundScores = { red:0, blue:0, green:0, yellow:0 };

  // DOM refs
  const scoreEls = {
    red: document.getElementById('score-red'),
    blue: document.getElementById('score-blue'),
    green: document.getElementById('score-green'),
    yellow: document.getElementById('score-yellow')
  };
  const roundLabel = document.getElementById('roundLabel');
  const finishRoundBtn = document.getElementById('finishRoundBtn');
  const saveBtn = document.getElementById('saveBtn');
  const resetBtn = document.getElementById('resetBtn');
  const leaderOverlay = document.getElementById('leaderOverlay');
  const ranksContainer = document.getElementById('ranksContainer');
  const overlayRoundNum = document.getElementById('overlayRoundNum');
  const continueBtn = document.getElementById('continueBtn');
  const finishAllBtn = document.getElementById('finishAllBtn');
  const ding = document.getElementById('ding');
  const ceremony = document.getElementById('ceremony');
  const winnerText = document.getElementById('winnerText');

  function persistTotals(){
    try { localStorage.setItem(storageKey, JSON.stringify(totalScores)); }
    catch(e){ console.warn('Save failed', e); }
  }

  function updateMainDisplay(){
    houseKeys.forEach(k => { scoreEls[k].textContent = roundScores[k]; });
  }

  function playDing(){
    if (!ding) return;
    const p = ding.play();
    if (p && p.catch) p.catch(()=>{/* ignore */});
  }

  // change only round scores
  function changeRoundScore(house, delta){
    if (!roundScores.hasOwnProperty(house)) return;
    roundScores[house] = (roundScores[house] || 0) + Number(delta);
    // clamp (optional): allow negatives if you want; currently allow negative values
    updateMainDisplay();
    playDing();
  }

  // build and show leaderboard using totalScores (after adding this round)
  function renderLeaderboard(){
    // accumulate this round into totals
    houseKeys.forEach(h => totalScores[h] = (totalScores[h]||0) + (roundScores[h]||0));
    // persist totals
    persistTotals();

    // reset round for fresh next round
    roundScores = { red:0, blue:0, green:0, yellow:0 };
    updateMainDisplay();

    // sort totals
    const arr = Object.entries(totalScores).sort((a,b)=> b[1] - a[1]);

    // render rows
    ranksContainer.innerHTML = '';
    arr.forEach(([house, val], idx) => {
      const row = document.createElement('div');
      row.className = 'rankRow';
      row.innerHTML = `
        <div class="name">${idx+1}. ${house.toUpperCase()}</div>
        <div class="value">${val}</div>
      `;
      ranksContainer.appendChild(row);
    });

    overlayRoundNum.textContent = currentRound;
    leaderOverlay.classList.add('show');
    leaderOverlay.setAttribute('aria-hidden','false');
  }

  function hideLeaderboard(){
    leaderOverlay.classList.remove('show');
    leaderOverlay.setAttribute('aria-hidden','true');
  }

  function showCeremony(){
    hideLeaderboard();
    ceremony.classList.add('show');
    // winner from totalScores
    const sorted = Object.entries(totalScores).sort((a,b)=> b[1] - a[1]);
    const winner = sorted[0] || ['None',0];
    winnerText.innerHTML = `
      üèÜ <span style="font-size:18px; color:var(--muted)">Winner:</span>
      <span class="house">${winner[0].toUpperCase()}</span>
      <div style="margin-top:8px; color:var(--muted)">with <strong style="color:#fff">${winner[1]}</strong> points</div>
    `;
  }

  // event delegation for point buttons
  document.addEventListener('click', (ev) => {
    const t = ev.target;
    if (!t) return;
    const house = t.getAttribute && t.getAttribute('data-house');
    const val = t.getAttribute && t.getAttribute('data-value');
    if (house && val !== null){
      changeRoundScore(house, Number(val));
    }
  });

  finishRoundBtn.addEventListener('click', () => {
    renderLeaderboard();
  });

  continueBtn.addEventListener('click', () => {
    hideLeaderboard();
    currentRound++;
    if (currentRound > TOTAL_ROUNDS){
      showCeremony();
      roundLabel.textContent = `All rounds finished`;
      return;
    }
    roundLabel.textContent = `Round ${currentRound} of ${TOTAL_ROUNDS}`;
  });

  finishAllBtn.addEventListener('click', () => {
    // end immediately
    showCeremony();
    roundLabel.textContent = `All rounds finished`;
  });

  saveBtn.addEventListener('click', () => {
    persistTotals();
    saveBtn.textContent = 'Saved ‚úì';
    setTimeout(()=> saveBtn.textContent = 'Save Now', 900);
  });

  resetBtn.addEventListener('click', () => {
    if (!confirm('Reset all scores? This clears saved totals too.')) return;
    roundScores = { red:0, blue:0, green:0, yellow:0 };
    totalScores = { red:0, blue:0, green:0, yellow:0 };
    persistTotals();
    updateMainDisplay();
    hideLeaderboard();
    ceremony.classList.remove('show');
    currentRound = 1;
    roundLabel.textContent = `Round ${currentRound} of ${TOTAL_ROUNDS}`;
  });

  // initial
  updateMainDisplay();
  roundLabel.textContent = `Round ${currentRound} of ${TOTAL_ROUNDS}`;

})();
</script>
</body>
</html>
